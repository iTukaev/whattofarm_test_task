# whattofarm_test_task
go test -v ./internal/handlers/getdata/ ./internal/handlers/update/

# Написать web-приложение (Go + Mongo DB), осуществляющее подсчёт запросов счётного пикселя в формате gif.

Возвращается минимальный однопиксельный gif размером 33 байта: 
47 49 46 38 39 61 01 00 01 00 00 00 00 21 F9 04 01 00 00 00 00 2C 00 00 00 00 01 00 01 00 00 02 00
(с валидным заголовком Content-type).

В качестве параметра при запросе пикселя могут передаваться:

1. Тип действия (view, click, install, ...)

2. Страна в формате (ru, gb, ...)

Пример запроса:
http://localhost:8000/counter.gif?action=view&country=ru

В базе данных данные вызовы должны приводить к подсчёту таких вызовов с группировкой по действиям и странам.

Примерный формат итоговой записи в базе данных:

{
  "_id": ObjectId("..."),
  "total": 123,
  "actions": {
    "view": {
      "total": 100
    },
    "click": {
      "total": 20
    },
    "install": {
      "total": 3
    },
    ...
  },
  "countries": {
    "ru": {
      "total": 50
    },
    "fr": {
      "total": 17
    },
    ...
  }
}

### Дополнительное задание: дополнить вложенные срезы данных:

{
  "_id": ObjectId("..."),
  "total": 123,
  "actions": {
    "view": {
      "total": 100
      "countries": {
        "ru": {
          "total": 80
        },
        "fr": {
          "total": 10
        },
        ...
      }
    },
    "click": {
      "total": 20,
        "countries": {
          "ru": {
            "total": 10
          },
          "fr": {
            "total": 5
          },
          ...
        }
      },
      ...
    },
    "countries": {
      "ru": {
        "total": 50,
        "actions": {
          "view": {
            "total": 40
          },
          "click": {
            "total": 40
          },
          ...
        }
      },
      ...
    }
}

### Дополнительное задание 2:

Сделать все то же самое, только с разбивкой на часовые бины, когда данные накапливаются целый час, после чего создается новый объект.
Отдельный плюс - через функцио агрегации собрать данные из данных часовых бинов в заданный фрагмент (например день с учётом временной зоны)

Предлагаю формат запроса:
http://localhost:8000/?time_begin=YYYY-MM-DD_HH_TZ&time_end=YYYY-MM-DD_HH_TZ

YYYY - год (например 2017)

MM - месяц (например 11)

DD - число месяца (например 25)

HH - час в 24 часовом формате

TZ - часовая зона в формате +(-)00 (например %2b10, -07, %2b00, где %2b заменяет "+")

time_begin - время начала первого отрезка

time_end - время начала последнего отрезка

Например:

http://localhost:8000/?time_begin=2022-01-15_14_%2b03&time_end=2022-01-15_14_%2b03 - будет агрегировать все данные 
15 января 2022 года с 14:00:00 до 15:00:00 не включая 15:00:00 по московскому времени

http://localhost:8000/?time_begin=2022-01-15_14_%2b03&time_end=2022-01-15_18_%2b03 - будет агрегировать все данные
15 января 2022 года с 14:00:00 до 19:00:00 не включая 19:00:00 по московскому времени

http://localhost:8000/?time_begin=2022-01-17_11_%2b05&time_end=2022-01-17_14_%2b05